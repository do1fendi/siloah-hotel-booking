(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[186],{8405:function(e,t,o){Promise.resolve().then(o.bind(o,3451))},3451:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return x}});var l=o(9268),r=o(6006),n=o(5846),a=o.n(n),s=o(4522),i=o(6008),u=o(6493),d=o(1856),c=o(9944),m=o(3182),g=o(189),f=o(1);function x(e){let[t,o]=(0,r.useState)(!1),{setCartData:n}=(0,f.Z)(),{country:x}=(0,g.Z)(),{lang:v}=(0,d.Z)(),{currency:h}=(0,c.Z)(),p=(0,i.useSearchParams)(),[b,y]=(0,r.useState)([]),{userData:N,setUserData:j}=(0,s.Z)(e=>e),[C,w]=(0,r.useState)([]),[R,k]=(0,r.useState)([]),{packs:T,setPackage:I}=(0,m.Z)(),[F,W]=(0,r.useState)(!1),[E,S]=(0,r.useState)({user:{fullName:"",email:""},orderer:{fullName:"",email:"",country:"",mobileCode:"",mobile:""},guest:{fullName:"",country:""},bookingDetail:[],payment:{totalAmount:0,currency:""}}),D=(0,r.useRef)(null),P=(0,r.useRef)(null),H=(0,r.useRef)(null),M=(0,r.useRef)(null),A=(0,r.useRef)(null),O=(0,r.useRef)(null),J=(0,r.useRef)(null),[L,B]=(0,r.useState)({orFn:{error:!1,state:!1,msg:{en:"Please enter your full name",tw:"請輸入姓名"}},orEmail:{error:!1,state:!1,msg:{en:"Please enter a valid email address so we can send you your booking confirmation",tw:"請輸入有效的電子信箱以便我們向您發送預訂確認郵件"}},orCountry:{error:!1,state:!1,msg:{en:"Please select country",tw:"請選擇國家"}},orMobile:{error:!1,state:!1,msg:{en:"Please entery the correct mobile",tw:"輸入正確的手機號碼"}},gsFn:{error:!1,state:!1,msg:{en:"Please enter your full name",tw:"請輸入姓名"}},gsCountry:{error:!1,state:!1,msg:{en:"Please select country",tw:"請選擇國家"}}});(0,r.useEffect)(()=>{S({...E,user:{...E.user,fullName:null==N?void 0:N.name,email:null==N?void 0:N.em}})},[N]),(0,r.useEffect)(()=>{let e=[];null!==JSON.parse((0,u.Jx)(T))&&"null"!==JSON.parse((0,u.Jx)(T))?(JSON.parse((0,u.Jx)(T)).map(t=>{e.push({loading:!0}),(async()=>{let e=await Z(t.rateKey);k(t=>t=[...t,e])})()}),w(e)):k([])},[p]);let Z=async e=>{let t={headers:{"Content-Type":"application/json","x-siloah":"siloah"},method:"POST",body:JSON.stringify({rateKey:e})};try{let e=await fetch("".concat("https://node.taiwanviptravel.com","/hotel/hotelSearch/checkPrice"),t),o=await e.json();return o.data.HotelPriceCheckRS.PriceCheckInfo}catch(e){console.log(e),alert("There is No Available Hotel")}},$=(e,t)=>{let o=new Date(t),l=new Date(e);return Math.ceil((o.getTime()-l.getTime())/864e5)},_=e=>{let t=new Date(e);return"TW"===v?"".concat(t.getFullYear()," 年 ").concat(t.getMonth()+1," 月 ").concat(t.getDate()," 日 (").concat(["日","一","二","三","四","五","六"][t.getDay()],")"):"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()]," ").concat(t.getDate()," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]," ").concat(t.getFullYear())};(0,r.useEffect)(()=>{if(R.length>0){let e=[],t=JSON.parse((0,u.Jx)(T))[0].noOfRoom;R.forEach((o,l)=>{var r,n,a,s,i,u,d,c,m,g,f,x,v,h,p,b,y,N,j,C,k,T,I,F,W,E,S,D,P,H,M,A,O,J,L;console.log(l,R[l]),w(e=>e=e.map((e,t)=>t===l?{loading:!1}:{...e}));let B=t>(null===(r=null===(n=o.HotelRateInfo)||void 0===n?void 0:null===(a=n.Rooms)||void 0===a?void 0:a.Room[0].RatePlans)||void 0===r?void 0:r.RatePlan[0].AvailableQuantity)?null===(s=null===(i=o.HotelRateInfo)||void 0===i?void 0:null===(u=i.Rooms)||void 0===u?void 0:u.Room[0].RatePlans)||void 0===s?void 0:s.RatePlan[0].AvailableQuantity:t,Z=(null===(d=o.HotelRateInfo)||void 0===d?void 0:null===(c=d.RateInfos)||void 0===c?void 0:c.ConvertedRateInfo)?null===(m=o.HotelRateInfo)||void 0===m?void 0:null===(g=m.RateInfos)||void 0===g?void 0:g.ConvertedRateInfo[0].AmountAfterTax:null===(f=o.HotelRateInfo)||void 0===f?void 0:null===(x=f.RateInfos)||void 0===x?void 0:x.RateInfo[0].AmountAfterTax;e.push({bookingKey:o.BookingKey,hotelCode:null===(v=o.HotelInfo)||void 0===v?void 0:v.HotelCode,hotelName:null===(h=o.HotelInfo)||void 0===h?void 0:h.HotelName,noOfRoom:B,roomType:null===(p=null===(b=o.HotelRateInfo)||void 0===b?void 0:null===(y=b.Rooms)||void 0===y?void 0:y.Room[0].RatePlans)||void 0===p?void 0:p.RatePlan[0].RatePlanName,checkIn:null===(N=o.HotelRateInfo)||void 0===N?void 0:N.RateInfos.RateInfo[0].StartDate,checkOut:null===(j=o.HotelRateInfo)||void 0===j?void 0:j.RateInfos.RateInfo[0].EndDate,noOfNight:$(null===(C=o.HotelRateInfo)||void 0===C?void 0:C.RateInfos.RateInfo[0].StartDate,null===(k=o.HotelRateInfo)||void 0===k?void 0:k.RateInfos.RateInfo[0].EndDate),amountAfterTax:Z,amountBeforeTax:(null===(T=o.HotelRateInfo)||void 0===T?void 0:null===(I=T.RateInfos)||void 0===I?void 0:I.ConvertedRateInfo)?null===(F=o.HotelRateInfo)||void 0===F?void 0:null===(W=F.RateInfos)||void 0===W?void 0:W.ConvertedRateInfo[0].AmountBeforeTax:null===(E=o.HotelRateInfo)||void 0===E?void 0:null===(S=E.RateInfos)||void 0===S?void 0:S.RateInfo[0].AmountBeforeTax,averageNightlyRate:(null===(D=o.HotelRateInfo)||void 0===D?void 0:null===(P=D.RateInfos)||void 0===P?void 0:P.ConvertedRateInfo)?null===(H=o.HotelRateInfo)||void 0===H?void 0:null===(M=H.RateInfos)||void 0===M?void 0:M.ConvertedRateInfo[0].AverageNightlyRate:null===(A=o.HotelRateInfo)||void 0===A?void 0:null===(O=A.RateInfos)||void 0===O?void 0:O.RateInfo[0].AverageNightlyRate,subAmount:B*Z,currency:o.ConvertedCurrencyCode?o.ConvertedCurrencyCode:o.CurrencyCode,penalty:null===(J=o.HotelRateInfo)||void 0===J?void 0:null===(L=J.Rooms)||void 0===L?void 0:L.Room[0].RatePlans.RatePlan[0].RateInfo.CancelPenalties.CancelPenalty[0]})}),S(t=>t={...t,bookingDetail:e,payment:{...t.payment,currency:e[0].currency,totalAmount:e.reduce((e,t)=>Math.round((e+t.subAmount)*100)/100,0)}})}},[R,p]);let K=e=>{switch(e.name){case"orFn":S({...E,orderer:{...E.orderer,fullName:e.value}}),B(t=>t=e.value.length<1?{...t,orFn:{...t.orFn,error:!0,state:!0}}:{...t,orFn:{...t.orFn,error:!1,state:!0}});break;case"orEmail":S({...E,orderer:{...E.orderer,email:e.value}}),B(t=>t=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g.test(e.value)?{...t,orEmail:{...t.orEmail,error:!1,state:!0}}:{...t,orEmail:{...t.orEmail,error:!0,state:!0}});break;case"orCountry":S(t=>t={...t,orderer:{...t.orderer,country:e.value,mobileCode:"TW"===v&&null!==e.value?x.filter(t=>t.tw===e.value).length>0?x.filter(t=>t.tw===e.value)[0].mobileCode:"":x.filter(t=>t.en===e.value).length>0?x.filter(t=>t.en===e.value)[0].mobileCode:""}}),B(t=>{let o=!1;return x.find(t=>t.en===e.value)&&(o=!0),x.find(t=>t.tw===e.value)&&(o=!0),t=o?{...t,orCountry:{...t.orCountry,error:!1,state:!0}}:{...t,orCountry:{...t.orCountry,error:!0,state:!0}}});break;case"orMobile":S({...E,orderer:{...E.orderer,mobile:e.value}}),B(t=>t=/^[1-9]\d{8,16}$/.test(e.value)?{...t,orMobile:{...t.orMobile,error:!1,state:!0}}:{...t,orMobile:{...t.orMobile,error:!0,state:!0}});break;case"gsFn":S({...E,guest:{...E.guest,fullName:e.value}}),B(t=>t=e.value.length<1?{...t,gsFn:{...t.gsFn,error:!0,state:!0}}:{...t,gsFn:{...t.gsFn,error:!1,state:!0}});break;case"gsCountry":S(t=>t={...t,guest:{...t.guest,country:e.value}}),B(t=>{let o=!1;return x.find(t=>t.en===e.value)&&(o=!0),x.find(t=>t.tw===e.value)&&(o=!0),t=o?{...t,gsCountry:{...t.gsCountry,error:!1,state:!0}}:{...t,gsCountry:{...t.gsCountry,error:!0,state:!0}}})}};(0,r.useEffect)(()=>{var e,o,l,r,n,a,s,i;!0===t?(null===(e=A.current)||void 0===e||e.classList.remove("scale-0"),null===(o=A.current)||void 0===o||o.classList.remove("h-0"),null===(l=A.current)||void 0===l||l.classList.add("scale-100"),null===(r=A.current)||void 0===r||r.classList.add("h-full")):(null===(n=A.current)||void 0===n||n.classList.add("h-0"),null===(a=A.current)||void 0===a||a.classList.remove("scale-100"),null===(s=A.current)||void 0===s||s.classList.remove("h-full"),null===(i=A.current)||void 0===i||i.classList.add("scale-0"))},[t]);let Q=()=>{let e=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g,o=/^[1-9]\d{8,16}$/;B(l=>{var r,a,s,i,u,d;return E.orderer.fullName.length<1?(l={...l,orFn:{...l.orFn,error:!0,state:!0}},null===(r=D.current)||void 0===r||r.focus()):e.test(E.orderer.email)?void 0===x.find(e=>e.en===E.orderer.country)&&void 0===x.find(e=>e.tw===E.orderer.country)?(l={...l,orCountry:{...l.orCountry,error:!0,state:!0}},null===(s=H.current)||void 0===s||s.focus()):o.test(E.orderer.mobile)?t&&E.guest.fullName.length<1?(l={...l,gsFn:{...l.gsFn,error:!0,state:!0}},null===(u=O.current)||void 0===u||u.focus()):t&&void 0===x.find(e=>e.en===E.guest.country)&&void 0===x.find(e=>e.tw===E.guest.country)?(l={...l,gsCountry:{...l.gsCountry,error:!0,state:!0}},null===(d=J.current)||void 0===d||d.focus()):(async()=>{W(!0);let e={headers:{"Content-Type":"application/json","x-siloah":"siloah"},method:"POST",body:JSON.stringify(E)};try{let t=await fetch("".concat("https://node.taiwanviptravel.com","/hotel/hotelBook/"),e),o=await t.json();console.log(o),I("null"),n("null"),location.reload()}catch(e){console.log(e)}W(!1)})():(l={...l,orMobile:{...l.orMobile,error:!0,state:!0}},null===(i=M.current)||void 0===i||i.focus()):(l={...l,orEmail:{...l.orEmail,error:!0,state:!0}},null===(a=P.current)||void 0===a||a.focus()),l})};return(0,l.jsx)("div",{className:"container mx-auto p-2 lg:p-0",children:C.length>0?(0,l.jsxs)("div",{className:"container mx-auto max-w-[1024px] p-2 lg:p-0 mt-5 flex flex-col lg:flex-row gap-5",children:[(0,l.jsxs)("div",{className:"left flex flex-col gap-5 border rounded border-luxgreen p-2 lg:p-5 w-full lg:w-5/12",children:[(0,l.jsx)("p",{className:"text-xl text-luxgreen font-bold",children:"TW"===v?"預訂摘要":"Booking Summary"}),C.map((e,t)=>e.loading?(0,l.jsxs)("div",{className:"w-full animate-pulse border p-2",children:[(0,l.jsx)("p",{className:"bg-slate-700 h-5 max-w-[400px] rounded-xl"}),(0,l.jsx)("p",{className:"bg-slate-700 h-3 max-w-[300px] mt-5 rounded-xl"}),(0,l.jsx)("p",{className:"bg-slate-700 h-3 max-w-[350px] mt-2 rounded-xl"}),(0,l.jsx)("p",{className:"border-b my-5"}),(0,l.jsx)("p",{className:"mt-2 flex justify-end",children:(0,l.jsx)("span",{className:"bg-slate-700 h-3 w-12 rounded-xl"})})]},t):(0,l.jsxs)("div",{className:"w-full border p-2",children:[(0,l.jsx)("p",{className:"text-md lg:text-lg text-luxgreen",children:E.bookingDetail[t].hotelName}),(0,l.jsx)("p",{className:"text-sm capitalize mt-5",children:E.bookingDetail[t].roomType.toLowerCase()}),(0,l.jsxs)("p",{className:"text-sm",children:[_(E.bookingDetail[t].checkIn)," ~"," ",_(E.bookingDetail[t].checkOut)," ｜"," ",$(E.bookingDetail[t].checkIn,E.bookingDetail[t].checkOut)," ","TW"===v?"晚":"Night"]}),(0,l.jsx)("p",{className:"border-b my-5"}),(0,l.jsxs)("p",{className:"text-right",children:[(0,l.jsx)("span",{className:"text-xs",children:"TWD"===h?"NT$ ":"$ "}),E.bookingDetail[t].subAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")]})]},t)),C[C.length-1].loading?(0,l.jsx)("div",{className:"w-full animate-pulse border p-2",children:(0,l.jsx)("p",{className:"mt-2 bg-slate-700 h-3 rounded-xl"})}):(0,l.jsx)("div",{className:"w-full border p-2",children:(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("p",{children:"TW"===v?"總價":"Total amount"}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"text-sm",children:"TWD"===h?"NT$ ":"$ "}),(0,l.jsx)("span",{className:"text-lg text-pink-700",children:E.payment.totalAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")})]})]})})]}),(0,l.jsx)("div",{className:"right w-full lg:w-7/12 flex flex-col gap-5",children:(0,l.jsxs)("div",{id:"orderer",className:"border border-gray-400 bg-gray-50 rounded p-2",children:[(0,l.jsx)("p",{className:"text-xl text-luxgreen font-bold",children:"TW"===v?"請填寫以下資訊":"Let us know who you are"}),(0,l.jsxs)("div",{className:"text-md mt-5 flex flex-col gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{htmlFor:"orFn",children:["TW"===v?"英文名(同護照)":"Full Name"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsx)("input",{ref:D,className:"focus:outline-0 focus:ring-2 border rounded w-full p-2 mt-2 ".concat(!0===L.orFn.state?!0===L.orFn.error?"border-pink-700":"border-green-600":""),type:"text",name:"orFn",id:"orFn",value:E.orderer.fullName,onChange:e=>K(e.currentTarget)}),L.orFn.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.orFn.msg.tw:L.orFn.msg.en})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{htmlFor:"orEmail",children:["TW"===v?"電子信箱":"Email"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsx)("input",{ref:P,className:"focus:outline-0 focus:ring-2 border rounded w-full p-2 mt-2 ".concat(!0===L.orEmail.state?!0===L.orEmail.error?"border-pink-700":"border-green-600":""),type:"email",name:"orEmail",id:"orEmail",value:E.orderer.email,onChange:e=>K(e.currentTarget)}),L.orEmail.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.orEmail.msg.tw:L.orEmail.msg.en})]}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row gap-5",children:[(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("label",{htmlFor:"orCountry",children:["TW"===v?"居住地":"Country"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsx)("input",{ref:H,list:"listCountry",className:"focus:outline-0 focus:ring-2 border rounded w-full p-2 mt-2 ".concat(!0===L.orCountry.state?!0===L.orCountry.error?"border-pink-700":"border-green-600":""),name:"orCountry",id:"orCountry",value:E.orderer.country,onChange:e=>K(e.currentTarget),onClick:()=>S({...E,orderer:{...E.orderer,country:""}})}),(0,l.jsx)("datalist",{id:"listCountry",children:"TW"===v?x.map(e=>(0,l.jsx)("option",{value:e.tw},e.mobileCode)):x.map(e=>(0,l.jsx)("option",{value:e.en},e.mobileCode))}),L.orCountry.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.orCountry.msg.tw:L.orCountry.msg.en})]}),(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("label",{htmlFor:"orMobile",children:["TW"===v?"電話號碼":"Mobile"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsxs)("div",{className:"w-full mt-2 flex ",children:[(0,l.jsx)("span",{className:"w-2/6 p-2 text-center border-l border-t border-b",children:E.orderer.mobileCode}),(0,l.jsx)("input",{className:"focus:outline-0 focus:ring-2 border rounded-r w-full p-2 ".concat(!0===L.orMobile.state?!0===L.orMobile.error?"border-pink-700":"border-green-600":""),ref:M,type:"text",name:"orMobile",id:"orMobile",value:E.orderer.mobile,onChange:e=>K(e.currentTarget)})]}),L.orMobile.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.orMobile.msg.tw:L.orMobile.msg.en})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{type:"checkbox",name:"bookForOther",id:"bookForOther",onChange:e=>o(e.currentTarget.checked)}),(0,l.jsx)("span",{className:"ml-2",children:"TW"===v?"為他人訂房":"Book for someone else"}),(0,l.jsxs)("div",{ref:A,className:"overflow-hidden transform origin-top-left transition-all duration-700 ease-out scale-0 h-0 bg-gray-100 p-2 lg:p-5",children:[(0,l.jsx)("p",{className:"text-lg font-semi",children:"TW"===v?"住客資料":"Guest Information"}),(0,l.jsxs)("div",{className:"mt-2 flex flex-col lg:flex-row justify-between gap-5",children:[(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("label",{htmlFor:"gsFn",children:["TW"===v?"英文名(同護照)":"Full Name"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsx)("input",{ref:O,className:"focus:outline-0 focus:ring-2 border rounded w-full p-2 mt-2 ".concat(!0===L.gsFn.state?!0===L.gsFn.error?"border-pink-700":"border-green-600":""),type:"text",name:"gsFn",id:"gsFn",value:E.guest.fullName,onChange:e=>K(e.currentTarget)}),L.gsFn.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.gsFn.msg.tw:L.gsFn.msg.en})]}),(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("label",{htmlFor:"gsCountry",children:["TW"===v?"居住地":"Country"," ",(0,l.jsx)("span",{className:"text-pink-700 text-lg",children:"*"})]}),(0,l.jsx)("input",{ref:J,list:"listCountry",className:"focus:outline-0 focus:ring-2 border rounded w-full p-2 mt-2 ".concat(!0===L.gsCountry.state?!0===L.gsCountry.error?"border-pink-700":"border-green-600":""),name:"gsCountry",id:"gsCountry",value:E.guest.country,onChange:e=>K(e.currentTarget),onClick:()=>S({...E,guest:{...E.guest,country:""}})}),(0,l.jsx)("datalist",{id:"listCountry",children:"TW"===v?x.map(e=>(0,l.jsx)("option",{value:e.tw},e.mobileCode)):x.map(e=>(0,l.jsx)("option",{value:e.en},e.mobileCode))}),L.gsCountry.error&&(0,l.jsx)("p",{className:"text-sm text-pink-700",children:"TW"===v?L.gsCountry.msg.tw:L.gsCountry.msg.en})]})]})]})]}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{className:"p-2 bg-luxorange hover:bg-orange-400 text-gray-100 w-full rounded",onClick:()=>Q(),children:"TW"===v?"下一步":"Next"})})]})]})})]}):(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-screen -mt-[110px]",children:[(0,l.jsx)("p",{className:"text-xl font-bold",children:"TW"===v?"沒有包存在":"No package is exist"}),(0,l.jsx)("div",{className:"mt-5",children:(0,l.jsx)(a(),{href:"/",children:(0,l.jsx)("button",{className:"text-gray-100 bg-luxorange text-lg py-2 px-5 rounded hover:bg-orange-400",children:"TW"===v?"找飯店":"Search Hotel"})})})]})})}},1:function(e,t,o){"use strict";var l=o(2561),r=o(4475),n=o(6493);let a=(0,l.Ue)()((0,r.tJ)(e=>({cartData:(0,n.cv)("null"),setCartData:t=>e({cartData:(0,n.cv)(t)})}),{name:"_cd"}));t.Z=a},3182:function(e,t,o){"use strict";var l=o(2561),r=o(4475),n=o(6493);let a=(0,l.Ue)()((0,r.tJ)(e=>({packs:(0,n.cv)("null"),setPackage:t=>e({packs:(0,n.cv)(t)})}),{name:"_pk"}));t.Z=a}},function(e){e.O(0,[23,846,895,253,488,744],function(){return e(e.s=8405)}),_N_E=e.O()}]);